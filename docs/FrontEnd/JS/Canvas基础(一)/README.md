# CanvasåŸºç¡€ä¸€

## èƒŒæ™¯

canvaså…ƒç´ æ˜¯html5ä¸­æœ€å—æ¬¢è¿çš„å…ƒç´ ,è¯¥å…ƒç´ è´Ÿè´£åœ¨é¡µé¢ä¸­è®¾å®šä¸€ä¸ªåŒºåŸŸ,ç„¶åé€šè¿‡javascriptåŠ¨æ€åœ°åœ¨è¯¥åŒºåŸŸä¸­ç»˜åˆ¶å›¾å½¢.é™¤äº†å…·å¤‡åŸºæœ¬å›å›¾èƒ½åŠ›çš„2Dä¸Šä¸‹æ–‡,canvasè¿˜æä¾›äº†åä¸ºWebGLçš„3Dä¸Šä¸‹æ–‡,éšç€æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶èƒ½åŠ›çš„æå‡,å‡ ä¹æ‰€æœ‰çš„ç°ä»£æµè§ˆå™¨å¯¹WebGLçš„æ”¯æŒéƒ½éå¸¸å¥½.

canvaså¯ä»¥ç”¨äºåŠ¨ç”»,æ¸¸æˆ,æ•°æ®å¯è§†åŒ–,å›¾ç‰‡ç¼–è¾‘åŠå®æ—¶è§†é¢‘å¤„ç†ç­‰æ–¹é¢.canvas apiä¸»è¦èšç„¦äº2Då›¾å½¢,WebGL apiåˆ™ç”¨äºç»˜åˆ¶ç¡¬ä»¶åŠ é€Ÿçš„2Då’Œ3Då›¾å½¢.

## åŸºæœ¬ç”¨æ³•

### `<canvas>`å…ƒç´ 

`<canvas id="myCanvas" width="150" height="150"></canvas>`

canvasçœ‹èµ·æ¥å’Œimgå…ƒç´ å¾ˆåƒ,ä½†æ˜¯canvasæ ‡ç­¾åªæœ‰`width`å’Œ`height`ä¸¤ä¸ªå±æ€§.å½“æ²¡æœ‰è®¾ç½®å®½é«˜æ—¶,canvasä¼šåˆå§‹åŒ–ä¸ºå®½åº¦300px,é«˜åº¦150px.è¯¥å…ƒç´ ä¹Ÿå¯ä½¿ç”¨cssæ¥å®šä¹‰å¤§å°,ä½†åœ¨ç»˜åˆ¶æ—¶å›¾åƒä¼šä¼¸ç¼©ä»¥é€‚åº”æ¡†æ¶å°ºå¯¸--å¦‚æœcssçš„å°ºå¯¸ä¸åˆå§‹ç”»å¸ƒçš„æ¯”ä¾‹ä¸ä¸€è‡´,å›¾åƒä¼šå‡ºç°æ‰­æ›².

* æ›¿ä»£å†…å®¹
canvasä¹Ÿåƒimg,pictureå…ƒç´ ä¸€æ ·,åœ¨æµè§ˆå™¨ä¸æ”¯æŒæ­¤ç‰¹æ€§æ—¶æ˜¾ç¤ºæ›¿ä»£å†…å®¹

`<canvas id="mycanvas">æ­¤æµè§ˆå™¨ä¸æ”¯æŒcanvas,è¯·å‡çº§æµè§ˆå™¨</canvas>`

* `</canvas>`æ ‡ç­¾ä¸å¯çœç•¥
### æ¸²æŸ“ä¸Šä¸‹æ–‡

canvaså…ƒç´ åˆ›é€ ä¸€ä¸ªå›ºå®šå¤§å°çš„ç”»å¸ƒ,å…¬å¼€äº†ä¸€ä¸ªæˆ–å¤šä¸ªæ¸²æŸ“ä¸Šä¸‹æ–‡,å¯ä»¥ç”¨æ¥ç»˜åˆ¶å’Œå¤„ç†è¦å±•ç¤ºçš„å†…å®¹.canvasèµ·åˆæ˜¯ç©ºç™½çš„,ä¸ºäº†å±•ç¤º,æˆ‘ä»¬é¦–å…ˆè¦è·å–åˆ°æ¸²æŸ“ä¸Šä¸‹æ–‡,åœ¨å®ƒä¸Šé¢ç»˜åˆ¶.canvasæä¾›äº†getContext()æ–¹æ³•æ¥è·å–æ¸²æŸ“ä¸Šä¸‹æ–‡.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getContext()æ–¹æ³•æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒcanvas.
```
var canvas = document.getElementById('myCanvas');
var ctx = canvas.getContext('2d');
```
## ç»˜åˆ¶å½¢çŠ¶

### ç”»å¸ƒæ …æ ¼å’Œåæ ‡ç©ºé—´

canvaså…ƒç´ é»˜è®¤è¢«ç½‘æ ¼è¦†ç›–,é€šå¸¸ç½‘æ ¼ä¸­çš„ä¸€ä¸ªå•å…ƒç›¸å½“äºcanvaså…ƒç´ ä¸­çš„ä¸€ä¸ªåƒç´ ,æ …æ ¼çš„èµ·ç‚¹ä¸ºå·¦ä¸Šè§’,åæ ‡ä¸º(0,0).æ‰€æœ‰å…ƒç´ çš„ä½ç½®éƒ½ç›¸å¯¹äºåŸç‚¹å®šä½.

### ç»˜åˆ¶çŸ©å½¢

canvasåªæ”¯æŒä¸¤ç§å½¢å¼çš„å›¾å½¢ç»˜åˆ¶: çŸ©å½¢å’Œè·¯å¾„(ç”±ä¸€ç³»åˆ—ç‚¹è¿æˆçš„çº¿æ®µ).æ‰€æœ‰å…¶ä»–ç±»å‹çš„å›¾å½¢éƒ½æ˜¯é€šè¿‡ä¸€æ¡æˆ–å¤šæ¡è·¯å¾„ç»„åˆè€Œæˆ.

canvasæä¾›äº†ä¸‰ç§ç»˜åˆ¶çŸ©å½¢çš„æ–¹æ³•:

* fillRect(x,y,width,height) ç»˜åˆ¶ä¸€ä¸ªå¡«å……çš„çŸ©å½¢
* strokeRect(x,y,width,height) ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢è¾¹æ¡†
* clearRect(x,y,width,height) æ¸…é™¤æŒ‡å®šçŸ©å½¢åŒºåŸŸ,è®©æ¸…é™¤éƒ¨åˆ†å®Œå…¨é€æ˜

x,yæŒ‡å®šäº†åœ¨canvasç”»å¸ƒä¸Šæ‰€ç»˜åˆ¶çš„çŸ©å½¢çš„å·¦ä¸Šè§’(ç›¸å¯¹äºåŸç‚¹)çš„åæ ‡.widthå’Œheightè®¾ç½®çŸ©å½¢çš„å°ºå¯¸.è¿™ä¸‰ä¸ªå‡½æ•°åœ¨ç»˜åˆ¶åä¼šç«‹å³ç”Ÿæ•ˆ.

### ç»˜åˆ¶è·¯å¾„

å›¾å½¢çš„1åŸºæœ¬å…ƒç´ æ˜¯è·¯å¾„.è·¯å¾„æ˜¯é€šè¿‡ä¸åŒé¢œè‰²å’Œå®½åº¦çš„çº¿æ®µæˆ–æ›²çº¿ç›¸è¿å½¢æˆçš„ä¸åŒå½¢çŠ¶çš„ç‚¹çš„é›†åˆ.è·¯å¾„æ˜¯é—­åˆçš„.

è·¯å¾„ç»˜åˆ¶ä¸€èˆ¬æ­¥éª¤:

1. åˆ›å»ºè·¯å¾„èµ·å§‹ç‚¹
2. ä½¿ç”¨ç”»å›¾å‘½ä»¤ç»˜åˆ¶è·¯å¾„
3. è·¯å¾„å°é—­
4. é€šè¿‡æè¾¹æˆ–å¡«å……è·¯å¾„åŒºåŸŸæ¥æ¸²æŸ“å›¾å½¢

* beginPath() æ–°å»ºä¸€æ¡è·¯å¾„,ç”Ÿæˆä¹‹å,å›¾å½¢ç»˜åˆ¶å‘½ä»¤è¢«æŒ‡å‘åˆ°è·¯å¾„ä¸Šç”Ÿæˆè·¯å¾„
* closePath() é—­åˆè·¯å¾„ä¹‹åå›¾å½¢ç»˜åˆ¶å‘½ä»¤åˆé‡æ–°æŒ‡å‘åˆ°ä¸Šä¸‹æ–‡
* stroke() é€šè¿‡çº¿æ¡æ¥ç»˜åˆ¶å›¾å½¢è½®å»“
* fill() é€šè¿‡å¡«å……è·¯å¾„çš„å†…å®¹åŒºåŸŸæ¥ç”Ÿæˆå®å¿ƒçš„å›¾å½¢

æ³¨æ„,å½“æˆ‘ä»¬è°ƒç”¨fill()æ–¹æ³•æ—¶,æ‰€æœ‰æ²¡æœ‰é—­åˆçš„å½¢çŠ¶ä¼šè‡ªåŠ¨é—­åˆ.

#### ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢
```
var canvas = document.getElementById('myCanvas');
if(canvas.getContext) {
    var ctx = canvas.getContext('2d');
    ctx.beginPath();
    ctx.moveTo(75, 50);
    ctx.lineTo(100, 75);
    ctx.lineTo(100, 25);
    ctx.fill();
}
```

* moveTo(x,y) å°†ç¬”è§¦ç§»åŠ¨åˆ°æŒ‡å®šçš„åæ ‡ä¸Š,ä¸ç»˜åˆ¶ä»»ä½•å†…å®¹
* lineTo(x,y) ç»˜åˆ¶ä¸€æ¡ä»å½“å‰ä½ç½®åˆ°æŒ‡å®šxyä½ç½®çš„ç›´çº¿
* arc(x,y,radius,startAngle,endAngle,anticlockwise) ç”»ä¸€ä¸ªä»¥(x,y)ä¸ºåœ†å¿ƒçš„ä»¥radiusä¸ºåŠå¾„çš„åœ†å¼§(åœ†),ä»startAngleå¼€å§‹åˆ°endAngleç»“æŸ(å¼§åº¦å•ä½,ä»¥xè½´ä¸ºåŸºå‡†),æŒ‰ç…§anticlockwise(å¸ƒå°”å€¼,trueé€†æ—¶é’ˆ,falseé¡ºæ—¶é’ˆ)ç»™å®šçš„æ–¹å‘(é»˜è®¤é¡ºæ—¶é’ˆ)æ¥ç”Ÿæˆ
* quadraticCurveTo(cp1x,cp1y,x,y) ç»˜åˆ¶äºŒæ¬¡è´å¡å°”æ›²çº¿,cp1x,cp1yä¸ºä¸€ä¸ªæ§åˆ¶ç‚¹,x,yä¸ºç»“æŸç‚¹
* bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y) ç»˜åˆ¶ä¸‰æ¬¡è´å¡å°”æ›²çº¿,cp1x,cp1yä¸ºæ§åˆ¶ç‚¹ä¸€,cp2x,cp2yä¸ºæ§åˆ¶ç‚¹äºŒ,x,yä¸ºç»“æŸç‚¹
* rect(x,y,width,height) ç»˜åˆ¶ä¸€ä¸ªå·¦ä¸Šè§’åæ ‡ä¸º(x,y),å®½åº¦ä¸ºwidth,é«˜åº¦ä¸ºheightçš„çŸ©å½¢,å½“è¯¥æ–¹æ³•æ‰§è¡Œæ—¶,å½“å‰ç¬”è§¦ä¼šè‡ªåŠ¨é‡ç½®åˆ°é»˜è®¤åæ ‡(0,0)

### Path2Då¯¹è±¡--ç¼“å­˜æˆ–è®°å½•ç»˜ç”»å‘½ä»¤,å¿«é€Ÿå›é¡¾è·¯å¾„

`new Path2D()`è¿”å›ä¸€ä¸ªæ–°åˆå§‹åŒ–çš„Path2Då¯¹è±¡,å¯ä»¥å°†æŸæ®µè·¯å¾„ä½œä¸ºå˜é‡æ¥åˆ›å»ºä¸€ä¸ªå‰¯æœ¬,æˆ–è€…å°†ä¸€ä¸ªåŒ…å«SVG pathæ•°æ®çš„å­—ç¬¦ä¸²ä½œä¸ºå˜é‡

* Path2D.addPath(path [, transform]) æ·»åŠ ä¸€æ¡è·¯å¾„åˆ°å½“å‰è·¯å¾„(å¯èƒ½æ·»åŠ ä¸€ä¸ªå˜æ¢çŸ©é˜µ)

```
var ctx = canvas.getContext('2d');
var rectangle = new Path2D();
rectangle.rect(10, 10, 50, 50);

var circle = new Path2D();
circle.moveTo(125, 35);
circle.arc(100, 35, 25, 0, 2 * Math.PI);

var p = new Path2D("M10 10 h 80 v 80 h -80 Z");

ctx.stroke(rectangle);
ctx.fill(circle);
ctx.fill(p);
```

## ä½¿ç”¨æ ·å¼å’Œé¢œè‰²

### è‰²å½©Colors

* fillStyle = color è®¾ç½®å›¾å½¢å¡«å……é¢œè‰²
* strokeStyle = color è®¾ç½®å›¾å½¢è½®å»“é¢œè‰²

colorå¯ä»¥æ˜¯è¡¨ç¤ºcssé¢œè‰²å€¼å¾—å­—ç¬¦ä¸²,æ¸å˜å¯¹è±¡æˆ–è€…å›¾æ¡ˆå¯¹è±¡,é»˜è®¤æƒ…å†µä¸‹ä¸ºé»‘è‰²

æ³¨æ„,ä¸€æ—¦è®¾ç½®äº†fillStyleæˆ–è€…strokeStyleå€¼,é‚£ä¹ˆè¿™ä¸ªæ–°å€¼å°±ä¼šæˆä¸ºæ–°ç»˜åˆ¶å›¾å½¢å¾—é»˜è®¤å€¼,å¦‚æœè¦ç»™æ¯ä¸ªå›¾å½¢ä¸Šä¸åŒå¾—é¢œè‰²,éœ€è¦é‡æ–°è®¾ç½®colorå€¼

### é€æ˜åº¦Transparency

* globalAlpha = transparencyValue å½±å“canvasä¸­æ‰€æœ‰å›¾å½¢å¾—é€æ˜åº¦,æœ‰æ•ˆèŒƒå›´åœ¨0åˆ°1ä¹‹é—´,é»˜è®¤ä¸º1
  
æ³¨æ„,å¦‚æœæ‰€æœ‰å›¾å½¢å¾—é€æ˜åº¦ä¸€è‡´,æˆ‘ä»¬æ¨èä½¿ç”¨æ­¤å±æ€§,å¦‚æœå›¾å½¢é€æ˜åº¦ä¸åŒæˆ‘ä»¬æ¨èä½¿ç”¨rgbaæ ¼å¼çš„é¢œè‰²è®¾ç½®.

### çº¿å‹Line Style

* lineWidth = value çº¿æ¡å®½åº¦,çº¿å®½æ˜¯æŒ‡ç»™å®šè·¯å¾„çš„ä¸­å¿ƒåˆ°ä¸¤è¾¹çš„ç²—ç»†,æ¢å¥è¯è¯´å°±æ˜¯è·¯å¾„çš„ä¸¤è¾¹å„ç»˜åˆ¶çº¿å®½çš„ä¸€åŠ,æ‰€ä»¥è¦ç‰¹åˆ«æ³¨æ„å¥‡æ•°çº¿å®½.å½“é¢œè‰²å¡«å……æ²¡æœ‰å¡«æ»¡æ•´ä¸ªcanvasç”»å¸ƒçš„ä¸€ä¸ªåƒç´ æ—¶,æœªå¡«å……éƒ¨åˆ†ä¼šä½¿ç”¨å®é™…ç¬”è§¦é¢œè‰²ä¸€åŠè‰²è°ƒçš„é¢œè‰²æ¥å¡«å……æ•´ä¸ªåŒºåŸŸ.
![canvas lineWidth](./images/canvas-lineWidth-grid.png)
* lineCap = type çº¿æ¡æœ«ç«¯æ ·å¼: butt, round, square
![canvas lineCap](./images/Canvas_linecap.png)
* lineJoin = type çº¿æ¡ä¸çº¿æ¡é—´æ¥åˆå¤„çš„æ ·å¼: round, bevel, miter
![canvas lineJoin](./images/Canvas_linejoin.png)
* miterLimit = value é™åˆ¶ä¸¤æ¡çº¿ç›¸äº¤æ—¶äº¤æ¥å¤„æœ€å¤§é•¿åº¦,äº¤æ¥å¤„é•¿åº¦(æ–œæ¥é•¿åº¦)æŒ‡çº¿æ¡äº¤æ¥å¤„å†…è§’é¡¶ç‚¹åˆ°å¤–è§’é¡¶ç‚¹çš„é•¿åº¦.
* getLineDash() è¿”å›ä¸€ä¸ªåŒ…å«å½“å‰è™šçº¿æ ·å¼,é•¿åº¦ä¸ºéè´Ÿå¶æ•°çš„æ•°ç»„
* setLineDash(segments) è®¾ç½®å½“å‰è™šçº¿æ ·å¼
* lineDashOffset = value è®¾ç½®è™šçº¿æ ·å¼çš„èµ·å§‹åç§»é‡

### æ¸å˜Gradients

* createLinearGradient(x1, y1, x2, y2) åˆ›å»ºä¸€ä¸ªcanvasGradientå¯¹è±¡,èµ·ç‚¹(x1,y1),ç»ˆç‚¹(x2,y2)
* createRadialGradient(x1,y1,r1,x2,y2,r2) åˆ›å»ºä¸€ä¸ªcanvasGradientå¯¹è±¡,èµ·ç‚¹ä¸ºä¸­å¿ƒä¸º(x1,y1),åŠå¾„ä¸ºr1çš„åœ†,ç»ˆç‚¹ä¸ºä¸­å¿ƒä¸º(x2,y2),åŠå¾„ä¸ºr2çš„åœ†

åˆ›å»ºå‡ºcanvasGradientå¯¹è±¡å,ä½¿ç”¨addColorStopæ–¹æ³•ä¸Šè‰²

* gradient.addColorStop(position, color) positionä¸º0-1ä¹‹é—´çš„æ•°å€¼,è¡¨ç¤ºæ¸å˜ä¸­é¢œè‰²çš„ç›¸å¯¹ä½ç½®,å¦‚0.5è¡¨ç¤ºé¢œè‰²åœ¨æ­£ä¸­é—´.colorä¸ºæœ‰æ•ˆçš„cssé¢œè‰²å€¼.
```
var lingrad = ctx.createLinearGradient(0,0,0,150);
lingrad.addColorStop(0, '#00ABEB');
lingrad.addColorStop(0.5, '#fff');
lingrad.addColorStop(0.5, '#26C000');
lingrad.addColorStop(1, '#fff');

var lingrad2 = ctx.createLinearGradient(0,50,0,95);
lingrad2.addColorStop(0.5, '#000');
lingrad2.addColorStop(1, 'rgba(0,0,0,0)');

ctx.fillStyle = lingrad;
ctx.strokeStyle = lingrad2;

ctx.fillRect(10,10,130,130);
ctx.strokeRect(50,50,50,50);
```
![Canvas lineargradient](./images/Canvas_lineargradient.png)

### å›¾æ¡ˆæ ·å¼Patterns

* createPattern(image, type) imageå¯ä»¥æ˜¯ä¸€ä¸ªimageå¯¹è±¡çš„å¼•ç”¨,æˆ–è€…å¦ä¸€ä¸ªcanvaså¯¹è±¡,typeä¸ºå­—ç¬¦ä¸²å€¼: repeat,repeat-x,repeat-y,no-repeat.

æ³¨æ„,å¦‚æœä½¿ç”¨imageå¯¹è±¡,éœ€è¦å…ˆç¡®è®¤imageå¯¹è±¡å·²ç»åŠ è½½å®Œæ¯•.

```
var img = new Image();
img.src = 'https://mdn.mozillademos.org/files/222/Canvas_createpattern.png';
img.onload = function() {
    var ptrn = ctx.createPattern(img, 'repeat');
    ctx.fillStyle = ptrn;
    ctx.fillRect(0, 0, 150, 150);
}
```

### é˜´å½±Shadows

* shadowOffsetX = float
* shadowOffsetY = float  
shadowOffsetXå’ŒshadowOffsetYç”¨æ¥è®¾å®šé˜´å½±åœ¨Xå’ŒYè½´çš„å»¶ç”³è·ç¦»,ä¸å—å˜æ¢çŸ©é˜µå½±å“,è´Ÿå€¼è¡¨ç¤ºé˜´å½±å‘ä¸Šæˆ–å·¦å»¶ä¼¸,æ­£å€¼è¡¨ç¤ºé˜´å½±å‘ä¸‹æˆ–å³å»¶ä¼¸,é»˜è®¤ä¸º0.
* shadowBlur = float shadowBlurç”¨äºè®¾å®šé˜´å½±çš„æ¨¡ç³Šç¨‹åº¦,å…¶æ•°å€¼å¹¶ä¸è·Ÿåƒç´ æ•°é‡æŒ‚é’©,ä¹Ÿä¸å—å˜æ¢çŸ©é˜µå½±å“,é»˜è®¤ä¸º0
* shadowColor = color æ ‡å‡†cssé¢œè‰²å€¼,ç”¨äºè®¾å®šé˜´å½±é¢œè‰²æ•ˆæœ,é»˜è®¤å…¨é€æ˜é»‘è‰²

### Canvaså¡«å……è§„åˆ™

å½“ä½¿ç”¨fill(æˆ–clip,isPointinPath)æ—¶,å¯ä»¥è®¾ç½®å¡«å……è§„åˆ™,è¯¥å¡«å……è§„åˆ™æ ¹æ®æŸå¤„åœ¨è·¯å¾„å¤–é¢æˆ–è€…é‡Œé¢æ¥å†³å®šè¯¥å¤„æ˜¯å¦è¢«å¡«å…….

* fill(String) nonzero(éé›¶ç¼ ç»•è§„åˆ™),evenodd(å¥‡å¶ç¼ ç»•è§„åˆ™)

## ç»˜åˆ¶æ–‡æœ¬

### ç»˜åˆ¶æ–‡æœ¬

* fillText(text, x, y [, maxWidth]) åœ¨æŒ‡å®šçš„(x,y)ä½ç½®å¡«å……æŒ‡å®šçš„æ–‡æœ¬,ç»˜åˆ¶çš„æœ€å¤§å®½åº¦å¯é€‰,æ–‡å­—å®å¿ƒ
* strokeText(text, x, y [, maxWidth]) åœ¨æŒ‡å®šçš„(x,y)ä½ç½®ç»˜åˆ¶æ–‡æœ¬è¾¹æ¡†,ç»˜åˆ¶çš„æœ€å¤§å®½åº¦å¯é€‰,æ–‡å­—ç©ºå¿ƒ

```
ctx.font = "48px serif";
ctx.fillText("Hello world", 10, 50);

ctx.strokeText("Hello world", 10, 50);
```

### æœ‰æ ·å¼çš„æ–‡æœ¬

* font = value ç»˜åˆ¶æ–‡æœ¬çš„æ ·å¼,ä½¿ç”¨å’Œcss fontå±æ€§ç›¸åŒçš„è¯­æ³•,é»˜è®¤10px sans-serif
* textAlign = value æ–‡æœ¬å¯¹é½é€‰é¡¹,start,end,left,right,center
* textBaseline = value åŸºçº¿å¯¹é½é€‰é¡¹,alphabetic,top,hanging,middle,ideographic,bottom
* direction = value æ–‡æœ¬æ–¹å‘,inherit,ltr,rtl
![baselines](./images/baselines.png)

### é¢„æµ‹é‡æ–‡æœ¬å®½åº¦

* measureText() è¿”å›ä¸€ä¸ªTextMetricså¯¹è±¡çš„å®½åº¦,æ‰€åœ¨åƒç´ 
```
var text = ctx.measureText("foo");
text.width; // 16;
```

## ä½¿ç”¨å›¾åƒ

canvasçš„å›¾åƒæ“ä½œèƒ½åŠ›,æ‹“å®½äº†æµè§ˆå™¨å¤„ç†å›¾ç‰‡å’Œå¼€å‘å¤§å‹æ¸¸æˆçš„èƒ½åŠ›

### è·å–éœ€è¦ç»˜åˆ¶çš„å›¾ç‰‡

canvas apiå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§ç±»å‹ä½œä¸ºå›¾ç‰‡çš„æº:

* HTMLImageElement ç”±Image()å‡½æ•°æ„é€ æˆ–è€…`<img>`å…ƒç´ 
* HTMLVideoElement ä½¿ç”¨`<video>`å…ƒç´ ä½œä¸ºå›¾ç‰‡æº
* HTMLCanvasElement ä½¿ç”¨å¦å¤–ä¸€ä¸ª`<canvas>`å…ƒç´ ä½œä¸ºå›¾ç‰‡æº
* ImageBitmap é«˜æ€§èƒ½ä½å›¾

#### ä»ç›¸åŒé¡µé¢è·å–å›¾ç‰‡

* document.images
* document.getElementsByTagName()
* document.getElementById()

#### è·¨åŸŸè·å–å›¾ç‰‡

åœ¨HTMLImageElementä¸Šä½¿ç”¨crossOriginå±æ€§,æˆ‘ä»¬å¯ä»¥è¯·æ±‚åŠ è½½å…¶ä»–åŸŸä¸‹çš„å›¾ç‰‡,å¦‚æœå›¾ç‰‡æœåŠ¡å™¨å…è®¸è·¨åŸŸè®¿é—®å›¾ç‰‡,åˆ™å¯ä»¥åœ¨canvasä¸Šä½¿ç”¨è¯¥å›¾ç‰‡,å¦åˆ™ä½¿ç”¨è¯¥å›¾ç‰‡ä¼šæ±¡æŸ“canvasè€ŒæŠ¥é”™.

#### ä½¿ç”¨å…¶ä»–canvaså…ƒç´ 

é€šè¿‡document.getElementsByTagName()å’Œdocument.getElementById()æ–¹æ³•è·å–å…¶ä»–canvaså…ƒç´ ,æ­¤canvaså¿…é¡»å·²ç»åˆ›å»º

#### ä»é›¶å¼€å§‹åˆ›å»ºå›¾åƒ

é€šè¿‡jsè„šæœ¬åˆ›å»ºä¸€ä¸ªHTMLImageElementå¯¹è±¡,åŠ è½½å›¾ç‰‡å,è°ƒç”¨drawImageæ–¹æ³•,å¦‚æœå›¾ç‰‡æ²¡åŠ è½½å®Œè°ƒç”¨,é‚£ä¹ˆcanvasä¸Šä»€ä¹ˆä¹Ÿä¸ä¼šæœ‰

#### é€šè¿‡data:urlæ–¹å¼åµŒå…¥å›¾åƒ

ä½¿ç”¨base64ç¼–ç çš„å­—ç¬¦ä¸²æ¥å®šä¹‰ä¸€å¼ å›¾ç‰‡,æ­¤æ–¹æ³•åŠ è½½çš„å›¾ç‰‡é€Ÿåº¦å¾ˆå¿«,ä½†æ˜¯å›¾ç‰‡æ²¡æ³•ç¼“å­˜,è€Œä¸”å¦‚æœå›¾ç‰‡å¤§çš„è¯,urlæ•°æ®ä¼šå¾ˆé•¿

#### ä½¿ç”¨è§†é¢‘å¸§

ä½¿ç”¨`<video>`ä¸­çš„è§†é¢‘å¸§,å³ä½¿è§†é¢‘æ˜¯ä¸å¯è§çš„

### ç»˜åˆ¶å›¾ç‰‡

è·å¾—å›¾åƒæºä»¥å,å°±å¯ä»¥ä½¿ç”¨drawImageæ–¹æ³•æ¥å°†å®ƒæ¸²æŸ“åˆ°canvasé‡Œäº†

* drawImage(image, x, y) imageä¸ºimageæˆ–canvaså¯¹è±¡,x,yæ˜¯å…¶åœ¨ç›®æ ‡canvasé‡Œçš„èµ·å§‹åæ ‡
* drawImage(image, x, y, width, height) widthå’Œheightä¸¤ä¸ªå‚æ•°æ§åˆ¶å‘canvasç”»å…¥æ—¶åº”è¯¥ç¼©æ”¾åˆ°çš„å¤§å°
* drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight) sx,sy,sWidth,sHeightå®šä¹‰å›¾åƒæºçš„åˆ‡ç‰‡çš„ä½ç½®å’Œå¤§å°, dx,dy,dWidth,dHeightåˆ™å®šä¹‰äº†åˆ‡ç‰‡çš„ç›®æ ‡æ˜¾ç¤ºä½ç½®å’Œå¤§å°
![Canvas drawimage](./images/Canvas_drawimage.jpg)

## å˜å½¢

### çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤

* save() ä¿å­˜ç”»å¸ƒçš„æ‰€æœ‰çŠ¶æ€
* restore() æ¢å¤ä¸Šæ¬¡canvasçŠ¶æ€

canvasçŠ¶æ€æŒ‡çš„æ—¶å½“å‰ç”»å¸ƒçš„æ‰€æœ‰æ ·å¼å’Œå˜å½¢çš„ä¸€ä¸ªå¿«ç…§(åªæ˜¯æ ·å¼å’Œå˜å½¢,ä¸åŒ…æ‹¬è·¯å¾„),å­˜å‚¨åœ¨æ ˆä¸­,æ¯å½“save()è°ƒç”¨å,å½“å‰çŠ¶æ€å°±è¢«æ¨å…¥æ ˆä¸­ä¿å­˜.

ä¸€ä¸ªç»˜ç”»çŠ¶æ€åŒ…æ‹¬: 1. å½“å‰åº”ç”¨çš„å˜å½¢(ç§»åŠ¨,æ—‹è½¬,ç¼©æ”¾) 2. å‰æ–‡å®šä¹‰çš„å„ç§æ ·å¼,é¢œè‰²,åç§»,é˜´å½±,æ¸å˜ç­‰ 3. å½“å‰çš„è£åˆ‡è·¯å¾„

æ¯æ¬¡è°ƒç”¨restore()æ–¹æ³•,ä¸Šä¸€ä¸ªä¿å­˜çš„çŠ¶æ€å°±ä»æ ˆä¸­å¼¹å‡ºæ‰€æœ‰è®¾å®šéƒ½æ¢å¤

### ç§»åŠ¨Translating

* translate(x, y) xä¸ºå·¦å³åç§»é‡,yä¸ºä¸Šä¸‹åç§»é‡,æ­¤æ–¹æ³•ç”¨æ¥ç§»åŠ¨canvaså’Œå®ƒçš„åŸç‚¹ä½ç½®

### æ—‹è½¬Rotaing

* rotate(angle) angleä¸ºæ—‹è½¬çš„è§’åº¦,é¡ºæ—¶é’ˆæ–¹å‘,å•ä½ä¸ºå¼§åº¦,æ­¤æ–¹æ³•ä»¥canvasåŸç‚¹ä¸ºä¸­å¿ƒç‚¹è¿›è¡Œæ—‹è½¬

### ç¼©æ”¾Scaling

* scale(x,y) xä¸ºæ°´å¹³ç¼©æ”¾å› å­,yä¸ºå‚ç›´ç¼©æ”¾å› å­,æ­¤æ–¹æ³•ç”¨æ¥å¢å‡å›¾å½¢åœ¨canvasä¸­çš„åƒç´ æ•°ç›®,å¯¹å½¢çŠ¶æˆ–ä½å›¾è¿›è¡Œç¼©å°å’Œæ”¾å¤§.ç”»å¸ƒåˆå§‹æƒ…å†µä¸‹,æ˜¯ä»¥å·¦ä¸Šè§’åæ ‡ä¸ºåŸç‚¹çš„ç¬¬ä¸€è±¡é™,å¦‚æœå‚æ•°ä¸ºè´Ÿå®æ•°,ç›¸å½“äºä»¥xæˆ–yè½´ä½œä¸ºå¯¹ç§°è½´é•œåƒåè½¬.

### å˜å½¢Transforms

* transform(m11, m12, m21, m22, dx, dy) æ­¤æ–¹æ³•å°†å½“å‰å˜å½¢çŸ©é˜µä¹˜ä»¥ä¸Šä¸€ä¸ªåŸºäºè‡ªèº«å‚æ•°çš„çŸ©é˜µ

m11: æ°´å¹³æ–¹å‘çš„ç¼©æ”¾
m12: æ°´å¹³æ–¹å‘çš„å€¾æ–œåç§»
m21: ç«–ç›´æ–¹å‘çš„å€¾æ–œåç§»
m22: ç«–ç›´æ–¹å‘çš„ç¼©æ”¾
dx: æ°´å¹³æ–¹å‘çš„ç§»åŠ¨
dy: ç«–ç›´æ–¹å‘çš„ç§»åŠ¨
* setTransform(m11, m12, m21, m22, dx, dy) æ­¤æ–¹æ³•å°†å½“å‰å˜å½¢çŸ©é˜µé‡ç½®ä¸ºå•ä½çŸ©é˜µ,ç„¶åç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨transformæ–¹æ³•
* resetTransform() é‡ç½®å½“å‰å˜å½¢ä¸ºå•ä½çŸ©é˜µ,ç­‰ä»·ä¸ctx.setTransform(1, 0, 0, 1, 0, 0);
```
var sin = Math.sin(Math.PI/6);
var cos = Math.cos(Math.PI/6);
ctx.translate(100, 100);
var c = 0;
for (var i=0; i <= 12; i++) {
  c = Math.floor(255 / 12 * i);
  ctx.fillStyle = "rgb(" + c + "," + c + "," + c + ")";
  ctx.fillRect(0, 0, 100, 10);
  ctx.transform(cos, sin, -sin, cos, 0, 0);
}

ctx.setTransform(-1, 0, 0, 1, 100, 100);
ctx.fillStyle = "rgba(255, 128, 255, 0.5)";
ctx.fillRect(0, 50, 100, 100);
```
![Canvas transform](./images/Canvas_transform.png)

## åˆæˆä¸è£å‰ª

### globalCompositeOperation

æˆ‘ä»¬ä¸ä»…å¯ä»¥åœ¨å·²æœ‰å›¾å½¢åé¢å†ç”»æ–°å›¾å½¢,è¿˜å¯ä»¥ç”¨æ¥é®ç›–æŒ‡å®šåŒºåŸŸ,æ¸…é™¤ç”»å¸ƒä¸­çš„æŸäº›éƒ¨åˆ†ä»¥åŠæ›´å¤šå…¶ä»–æ“ä½œ

* globalCompositeOperation = type è®¾å®šåœ¨ç”»æ–°å›¾å½¢æ—¶é‡‡ç”¨çš„é®ç›–ç­–ç•¥
1. source-over é»˜è®¤è®¾ç½®,åœ¨ç°æœ‰ç”»å¸ƒä¸Šä¸‹æ–‡ä¸Šç»˜åˆ¶æ–°å›¾å½¢
2. source-in æ–°å›¾å½¢æ—¨åœ¨æ–°å›¾å½¢å’Œç›®æ ‡ç”»å¸ƒé‡å çš„åœ°æ–¹ç»˜åˆ¶,å…¶ä»–éƒ½æ˜¯é€æ˜çš„
3. source-out åœ¨ä¸ä¸ç°æœ‰ç”»å¸ƒå†…å®¹é‡å çš„åœ°æ–¹ç»˜åˆ¶æ–°å›¾å½¢
4. source-atop æ–°å›¾å½¢åªåœ¨ä¸ç°æœ‰ç”»å¸ƒå†…å®¹é‡å çš„åœ°æ–¹ç»˜åˆ¶
5. destination-over åœ¨ç°æœ‰ç”»å¸ƒå†…å®¹åé¢ç»˜åˆ¶æ–°çš„å›¾å½¢
6. destination-in ç°æœ‰çš„ç”»å¸ƒå†…å®¹ä¿æŒåœ¨æ–°å›¾å½¢å’Œç°æœ‰ç”»å¸ƒå†…å®¹é‡å çš„ä½ç½®,å…¶ä»–éƒ½æ˜¯é€æ˜çš„
7. destination-out ç°æœ‰å†…å®¹ä¿æŒåœ¨æ–°å›¾å½¢ä¸é‡å çš„åœ°æ–¹
8. destination-atop ç°æœ‰ç”»å¸ƒåªä¿ç•™ä¸æ–°å›¾å½¢é‡å çš„éƒ¨åˆ†,æ–°å›¾å½¢æ˜¯åœ¨ç”»å¸ƒå†…å®¹åé¢ç»˜åˆ¶çš„
9. lighter ä¸¤ä¸ªé‡å å›¾å½¢çš„é¢œè‰²æ˜¯é€šè¿‡é¢œè‰²å€¼æƒ³åŠ æ¥ç¡®å®šçš„
10. copy åªæ˜¾ç¤ºæ–°å›¾å½¢
11. xor å›¾åƒä¸­,é‚£äº›é‡å å’Œæ­£å¸¸ç»˜åˆ¶å¤–çš„å…¶ä»–åœ°æ–¹æ˜¯é€æ˜çš„
12. multiply å°†é¡¶å±‚åƒç´ ä¸åº•å±‚ç›¸åº”åƒç´ ç›¸ä¹˜,ç»“æœæ˜¯ä¸€å¹…æ›´é»‘æš—çš„å›¾ç‰‡
13. screen åƒç´ å€’è½¬,ç›¸ä¹˜,å†å€’è½¬,ç»“æœæ˜¯ä¸€å¹…æ›´æ˜äº®çš„å›¾ç‰‡
14. overlay multiplyå’Œscreençš„ç»“åˆ,æš—çš„åœ°æ–¹æ›´æš—,äº®çš„åœ°æ–¹æ›´äº®
15. darken ä¿ç•™ä¸¤ä¸ªå›¾å±‚ä¸­æœ€æš—çš„åƒç´ 
16. lighten ä¿ç•™ä¸¤ä¸ªå›¾å±‚ä¸­æœ€äº®çš„åƒç´ 
17. color-dodge å°†åº•å±‚é™¤ä»¥é¡¶å±‚çš„åç½®
18. color-burn å°†åç½®çš„åº•å±‚é™¤ä»¥é¡¶å±‚,ç„¶åå°†ç»“æœåè¿‡æ¥
19. hard-light å±å¹•ç›¸ä¹˜,ç±»ä¼¼äºå åŠ ,ä½†ä¸Šä¸‹å›¾å±‚äº’æ¢
20. soft-light ç”¨é¡¶å±‚å‡å»åº•å±‚æˆ–è€…ç›¸åæ¥å¾—åˆ°ä¸€ä¸ªæ­£å€¼
21. difference ä¸€ä¸ªæŸ”å’Œç‰ˆæœ¬çš„å¼ºå…‰(hard-light),çº¯é»‘æˆ–çº¯ç™½ä¸ä¼šå¯¼è‡´çº¯é»‘æˆ–çº¯ç™½
22. exclusion å’Œdifferencrç›¸ä¼¼,ä½†å¯¹æ¯”åº¦è¾ƒä½
23. hue ä¿ç•™åº•å±‚çš„äº®åº¦å’Œè‰²åº¦,åŒæ—¶é‡‡ç”¨é¡¶å±‚çš„è‰²è°ƒ
24. saturation ä¿ç•™åº•å±‚çš„äº®åº¦å’Œè‰²è°ƒ,é‡‡ç”¨é¡¶å±‚çš„è‰²åº¦
25. color ä¿ç•™åº•å±‚çš„äº®åº¦,é‡‡ç”¨é¡¶å±‚çš„è‰²è°ƒå’Œè‰²åº¦
26. luminosity ä¿æŒåº•å±‚çš„è‰²è°ƒå’Œè‰²åº¦,é‡‡ç”¨é¡¶å±‚çš„äº®åº¦

ğŸ˜‚(ï¿£_ï¿£|||) ç±»å‹å¤ªå¤šäº†,åªåšä¸ªè®°å½•

### è£åˆ‡è·¯å¾„

è£åˆ‡è·¯å¾„å’Œæ™®é€šçš„canvaså›¾å½¢å·®ä¸å¤š,ä¸åŒçš„æ˜¯å®ƒçš„ä½œç”¨æ˜¯é®ç½©,ç”¨æ¥éšè—ä¸éœ€è¦çš„éƒ¨åˆ†.

* clip() å°†å½“å‰æ­£åœ¨æ„å»ºçš„1è·¯å¾„è½¬æ¢ä¸ºå½“å‰çš„è£å‰ªè·¯å¾„
```
var ctx = document.getElementById('canvas').getContext('2d');
// ç»˜åˆ¶é»‘è‰²èƒŒæ™¯
ctx.fillRect(0,0,150,150);
// å°†åŸç‚¹ç§»åŠ¨åˆ°ä¸­å¿ƒ
ctx.translate(75,75);
// ç»˜åˆ¶åœ†å½¢è·¯å¾„
ctx.beginPath();
ctx.arc(0,0,60,0,Math.PI*2,true);
// åœ†å½¢è·¯å¾„è£å‰ª
ctx.clip();
// èƒŒæ™¯æ¸å˜è‰²
var lingrad = ctx.createLinearGradient(0,-75,0,75);
lingrad.addColorStop(0, '#232256');
lingrad.addColorStop(1, '#143778');

ctx.fillStyle = lingrad;
ctx.fillRect(-75,-75,150,150);
// draw stars
for (var j=1;j<50;j++){
  ctx.save();
  ctx.fillStyle = '#fff';
  // æ˜Ÿæ˜Ÿä½ç½®éšæœºåˆ†å¸ƒ
  ctx.translate(75-Math.floor(Math.random()*150),
                75-Math.floor(Math.random()*150));
  drawStar(ctx,Math.floor(Math.random()*4)+2);
  ctx.restore();
}
// ç»˜åˆ¶éšæœºå¤§å°çš„æ˜Ÿæ˜Ÿ
function drawStar(ctx,r){
  ctx.save();
  ctx.beginPath()
  ctx.moveTo(r,0);
  for (var i=0;i<9;i++){
    ctx.rotate(Math.PI/5);
    if(i%2 == 0) {
      ctx.lineTo((r/0.525731)*0.200811,0);
    } else {
      ctx.lineTo(r,0);
    }
  }
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}
```
![Canvas clip](./images/Canvas_clip.png)
